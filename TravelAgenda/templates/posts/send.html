{% extends 'base.html' %}

{% block title %}Create Post{% endblock %}
{% block trace %}
<div class="container-fluid px-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb my-0">
            <li class="breadcrumb-item"><span>Home</span></li>
            <li class="breadcrumb-item"><span>Posts</span></li>
            <li class="breadcrumb-item"><span>My Posts</span></li>
            <li class="breadcrumb-item active"><span>Send</span></li>
        </ol>
    </nav>
</div>
{% endblock %}
{% block content %}
<div class="container-lg px-4">
    <div class="card">
       
        <h5 class="card-header text-center">
            <i class="bi bi-pencil"></i> 新建游记
        </h5>
        <!-- <h5 class="card-header">Featured</h5> -->
        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
        
                <!-- Post Title -->
                <div class="input-group mb-3">
                    <span class="input-group-text" id="title-addon">@</span>
                    <input type="text" class="form-control" name="title" placeholder="Post Title" aria-label="Post Title" aria-describedby="title-addon" required>
                </div>
        
                <!-- Post Content -->
                <div class="input-group mb-3">
                    <span class="input-group-text">Content</span>
                    <textarea class="form-control" id="post-content" name="content" aria-label="With textarea" placeholder="Write your post here..." rows="5" required></textarea>
                    
                </div>
                <div class="text-danger mt-2" id="content-error" style="display: none;">Content must be between 10 and 500 characters.</div>
                <!-- Image Upload -->
                <div class="mb-3">
                    <label for="image-upload" class="form-label">Upload Images (Max 9)</label>
                    <button type="button" id="add-image-btn" class="btn btn-secondary btn-sm">Add Image</button>
                    <div id="image-upload-container">
                        <input type="file" class="form-control mb-2" name="images" accept="image/*">
                    </div>
                    
                    <div class="text-danger mt-2" id="file-error" style="display: none;">You can upload up to 9 images only.</div>
                </div>
                <div class="text-danger mt-2" id="file-error" style="display: none;">You can upload up to 9 images only.</div>
                <!-- Submit Button -->
                <a class="btn btn-outline-primary" href="{% url 'posts:my_post' %}">
                    <i class="bi bi-arrow-left"></i> 返回我的游记
                </a>
                <button type="submit" class="btn btn-primary">Submit Post</button>
            </form>
            
        </div>
      </div>
    
    <!-- <button type="button" class="btn btn-outline-primary">
        <i class="bi bi-trash"></i> 批量删除
    </button> -->
    
</div>
{% endblock %}
{% block script %}
<script>
    document.getElementById('image-upload').addEventListener('change', function() {
        const fileInput = this;
        const errorDiv = document.getElementById('file-error');
        
        if (fileInput.files.length > 9) {
            errorDiv.style.display = 'block';
            fileInput.value = ''; // Clear the input
        } else {
            errorDiv.style.display = 'none';
        }
    });
</script>
<script>
    document.querySelector('form').addEventListener('submit', function(event) {
        const content = document.getElementById('post-content').value.trim();
        const contentError = document.getElementById('content-error');
        
        if (content.length < 10 || content.length > 500) {
            event.preventDefault();
            contentError.style.display = 'block';
        } else {
            contentError.style.display = 'none';
        }
    });
</script>
<script>
    document.getElementById('add-image-btn').addEventListener('click', function() {
        const container = document.getElementById('image-upload-container');
        const fileInputs = container.querySelectorAll('input[type="file"]');

        // Check if the limit of 9 images has been reached
        if (fileInputs.length >= 9) {
            document.getElementById('file-error').style.display = 'block';
            return;
        } else {
            document.getElementById('file-error').style.display = 'none';
        }

        // Create a new file input field
        const newFileInput = document.createElement('input');
        newFileInput.type = 'file';
        newFileInput.name = 'images';
        newFileInput.className = 'form-control mb-2';
        newFileInput.accept = 'image/*';

        container.appendChild(newFileInput);
    });
</script>
{% endblock %}